<!DOCTYPE html>
<html>

<head>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.3/html2pdf.bundle.min.js"></script>
</head>

<body>
    <style>
        table {
            size: 100%;
        }

        .pdf-content {
            size: 100%
        }
    </style>
    <div id="pdf-content">
        <table id="calcTable">
            <tr>
                <th>Emelet</th>
                <th>Helyiség</th>
                <th>Szélesség [m]</th>
                <th>Hosszúság [m]</th>
                <th>Rendszer</th>
            </tr>
        </table>

        <br>
        <p>Total Price: <span id="calc_price">0</span></p>
    </div>

    <button onclick="addRow()">Helyiség Hozzáadása</button>
    <button onclick="getOffer()">Árajánlat</button>
    <button onclick="downloadPDF()">PDF Letöltés</button>

</body>

<script>
    // Function to add a new row
    function addRow() {
        const table = document.getElementById('calcTable');
        const newRow = table.insertRow();

        const cell_emelet = newRow.insertCell();
        cell_emelet.innerHTML = `
        <select>
            <option value="-1">Pince</option>
            <option value="0">Földszint</option>
            <option value="1">I. Emelet</option>
            <option value="2">II. Emelet</option>
            <option value="3">III. Emelet</option>
        </select>
    `
        const cell_helyiseg = newRow.insertCell();
        cell_helyiseg.innerHTML = `
        <select>
            <option value="Nappali">Nappali</option>
            <option value="Konyha">Konyha</option>
            <option value="Etkezo">Étkező</option>
            <option value="Haloszoba">Hálószoba</option>
            <option value="Gyerekszoba">Gyerekszoba</option>
            <option value="Dolgozoszoba">Dolgozószoba</option>
            <option value="Vendegszoba">Vendégszoba</option>
            <option value="Eloszoba">Előszoba</option>
            <option value="Furdoszoba">Fürdőszoba</option>
            <option value="Zuhanyzo">Zuhanyzó</option>
            <option value="Garazs">Garázs</option>
            <option value="Egyeb">Egyéb</option>
        </select>
    `

        const cell_szelesseg = newRow.insertCell();
        cell_szelesseg.innerHTML = '<input type="number" placeholder="0">';

        const cell_hosszusag = newRow.insertCell();
        cell_hosszusag.innerHTML = '<input type="number" placeholder="0">';

        const cell_rendszer = newRow.insertCell();
        cell_rendszer.innerHTML = `
        <select>
            <option value="BK100">BK100</option>
            <option value="AM333">AM333</option>
            <option value="AM400">AM400</option>
            <option value="VA75">VA75</option>
        </select>
    `;
    } // put in the first row instantly
    document.addEventListener("DOMContentLoaded", addRow);

    // Function to calculate the total price
    function getOffer() {
        const table = document.getElementById('calcTable');
        let totalPrice = 0;

        pdf_rows = []
        // Loop through rows, skip the header row (index 0)
        for (let i = 1; i < table.rows.length; i++) {
            const row = table.rows[i];

            const width = parseFloat(row.cells[2].querySelector('input').value) || 0;
            const length = parseFloat(row.cells[3].querySelector('input').value) || 0;
            const system = row.cells[4].querySelector('select').value;

            let area = width * length;
            let rows = makeOfferRows(area, system)
            for(let i = 0; i < rows.length; i++){
                pdf_rows.push(rows[i])
            }
        }

        // Update the price display
        document.getElementById('calc_price').textContent = 0;

        // Update the table
        makePDFcontent(pdf_rows);
    }

    function makeOfferRows(area, system){
        let rows = []
        switch (system){
            case "BK100":
                rows.push({
                    termeknev:"béka100",
                    egyseg:"m^2",
                    mennyiseg:area,
                    egysegar:2000,
                    teljesar:0
                });
                break;
            case "AM333":
                rows.push({
                    termeknev:"am333",
                    egyseg:"m^2",
                    mennyiseg:area,
                    egysegar:2000,
                    teljesar:0
                })
                break;
            case "AM400":
                rows.push({
                    termeknev:"am400",
                    egyseg:"m^2",
                    mennyiseg:area,
                    egysegar:2000,
                    teljesar:0
                })
                break;
            case "VA75":
                rows.push({
                    termeknev:"va75",
                    egyseg:"m^2",
                    mennyiseg:area,
                    egysegar:2000,
                    teljesar:0
                })
                break;
        }
        return rows;
    }

    function makePDFcontent(rows) {
        const table = document.getElementById('calcTable');
        table.innerHTML = `
            <tr>
                <th>Termék Név</th>
                <th>Mennyiségi egység</th>
                <th>Mennyiség</th>
                <th>Egységár [Ft]</th>
                <th>Teljes Ár [Ft]</th>
            </tr>
            `
        for(let i = 0; i < rows.length; i++){
            let newRow = table.insertRow();
            let j = 0;
            for(let key in rows[i]){
                let cell = newRow.insertCell()
                cell.innerHTML = "<p>"+rows[i][key]+"</p>"
            }
        }
    }

    function downloadPDF() {
        const element = document.getElementById('pdf-content');
        html2pdf().from(element).save();
    }
</script>

</html>